<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Satoru Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started/prerequisites.html"><strong aria-hidden="true">1.1.</strong> Prerequisites</a></li><li class="chapter-item expanded "><a href="getting-started/build.html"><strong aria-hidden="true">1.2.</strong> Build the contracts</a></li><li class="chapter-item expanded "><a href="getting-started/test.html"><strong aria-hidden="true">1.3.</strong> Test the contracts</a></li></ol></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/index.html"><strong aria-hidden="true">2.</strong> Smart contracts architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="smart-contracts-architecture/overview.html"><strong aria-hidden="true">2.1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/adl-module.html"><strong aria-hidden="true">2.2.</strong> Adl Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/callback-module.html"><strong aria-hidden="true">2.3.</strong> Callback Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/data-module.html"><strong aria-hidden="true">2.4.</strong> Data Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/exchange-module.html"><strong aria-hidden="true">2.5.</strong> Exchange Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/feature-module.html"><strong aria-hidden="true">2.6.</strong> Feature Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/fee-module.html"><strong aria-hidden="true">2.7.</strong> Fee Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/gas-module.html"><strong aria-hidden="true">2.8.</strong> Gas Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/liquidation-module.html"><strong aria-hidden="true">2.9.</strong> Liquidation</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/mock-module.html"><strong aria-hidden="true">2.10.</strong> Mock</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/nonce-module.html"><strong aria-hidden="true">2.11.</strong> Nonce Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/oracle-module.html"><strong aria-hidden="true">2.12.</strong> Oracle Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/order-module.html"><strong aria-hidden="true">2.13.</strong> Order Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/position-module.html"><strong aria-hidden="true">2.14.</strong> Position Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/pricing-module.html"><strong aria-hidden="true">2.15.</strong> Pricing Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/reader-module.html"><strong aria-hidden="true">2.16.</strong> Reader Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/referral-module.html"><strong aria-hidden="true">2.17.</strong> Referral Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/router-module.html"><strong aria-hidden="true">2.18.</strong> Router Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/role-module.html"><strong aria-hidden="true">2.19.</strong> Role Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/swap-module.html"><strong aria-hidden="true">2.20.</strong> Swap Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/utils-module.html"><strong aria-hidden="true">2.21.</strong> Utils Module</a></li><li class="chapter-item expanded "><a href="smart-contracts-architecture/withdrawal-module.html"><strong aria-hidden="true">2.22.</strong> Withdrawal Module</a></li></ol></li><li class="chapter-item expanded "><a href="continuous-integration/index.html"><strong aria-hidden="true">3.</strong> Continuous Integration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="continuous-integration/workflows.html"><strong aria-hidden="true">3.1.</strong> Github Workflows Documentation</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Satoru Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/keep-starknet-strange/satoru/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="satoru"><a class="header" href="#satoru">Satoru</a></h1>
<p>Satoru is a cutting-edge synthetics platform for Starknet, taking inspiration from the modular design of GMX v2.</p>
<p><img src="./assets/satoru-whats-up.gif" alt="Satoru Whats Up" /></p>
<p>Like it's namesake, Satoru is <strong>powerful</strong> and <strong>badass</strong>. It's also a bit of a mystery. We don't know what it's capable of yet, but we're excited to find out.</p>
<p>Combine the power of <strong>Starknet</strong> with it's huge computation capacity to the great design of <strong>GMX v2</strong>, and you get Satoru, a synthetics platform that is fast, cheap and scalable.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>In this section, we will go through the steps to build and test the smart contracts.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h1>
<ul>
<li><a href="https://foundry-rs.github.io/starknet-foundry/">Starknet Foundry</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-the-contracts"><a class="header" href="#build-the-contracts">Build the contracts</a></h1>
<p>Open a terminal and run the following command:</p>
<pre><code class="language-shell">scarb build
</code></pre>
<p>This will build the smart contracts into <code>target</code> directory.</p>
<p>Sample output:</p>
<pre><code class="language-shell">tree target/dev
target/dev
├── satoru.starknet_artifacts.json
├── satoru_DataStore.sierra.json
└── satoru_RoleStore.sierra.json
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-the-contracts"><a class="header" href="#test-the-contracts">Test the contracts</a></h1>
<p>Open a terminal and run the following command:</p>
<pre><code class="language-shell">snforge
</code></pre>
<p>This will execute the tests in <code>tests</code> directory and print the results.</p>
<p>Sample output:</p>
<pre><code class="language-shell">Collected 4 test(s) and 3 test file(s)
Running 0 test(s) from src/lib.cairo
Running 2 test(s) from tests/data/test_data_store.cairo
[PASS] test_data_store::test_data_store::test_get_and_set_felt252
[PASS] test_data_store::test_data_store::test_get_and_set_u256
Running 2 test(s) from tests/role/test_role_store.cairo
[PASS] test_role_store::test_role_store::test_grant_role
[PASS] test_role_store::test_role_store::test_revoke_role
Tests: 4 passed, 0 failed, 0 skipped
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smart-contracts-architecture"><a class="header" href="#smart-contracts-architecture">Smart contracts architecture</a></h1>
<p>In this section, we will go through the smart contracts architecture.</p>
<p>Satoru is composed of several modules. Each module is a set of smart contracts and libraries that are related to a specific area.</p>
<p>The goal of this architecture is to make the code more readable and maintainable, as well as to make it easier to add new features.</p>
<p>Another goal is to enable composability. For example, the <code>Role</code> module can be used in any other module to add role-based access control to the module's functions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="protocol-overview"><a class="header" href="#protocol-overview">Protocol Overview</a></h1>
<p><img src="smart-contracts-architecture/../assets/satoru-diagram.png" alt="Schema" />
Satoru high-level modules overview.</p>
<h2 id="two-steps-actions-in-satoru"><a class="header" href="#two-steps-actions-in-satoru">Two steps actions in Satoru</a></h2>
<p>Satoru employs a two-step approach for critical actions like Deposit, Withdrawal, and Order execution. This method ensures enhanced security and guards against front-running risks.</p>
<p><img src="smart-contracts-architecture/../assets/satoru-two-steps.png" alt="TwoStepsActions" /></p>
<p>First user send its request and then it is verified and executed by a Keeper. This helps protect users from front-running issues.</p>
<p><strong>Process Overview:</strong></p>
<ol>
<li>
<p><strong>User Initiation:</strong> Users initiate actions by sending requests.</p>
</li>
<li>
<p><strong>Keeper Verification:</strong> A designated Keeper validates requests and executes actions on users' behalf.</p>
</li>
</ol>
<p>This approach safeguards against unauthorized actions and provides users with secure, reliable interactions within the system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adl-module"><a class="header" href="#adl-module">Adl module</a></h1>
<p>The adl module helps with the auto-deleveraging.</p>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/adl/adl.cairo">adl.cairo</a>: Helps with the auto-deleveraging. This is particularly for markets with an index token that is different from the long token.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="callback-module"><a class="header" href="#callback-module">Callback module</a></h1>
<p>Most features of satoru require a two step process to complete. The Callback module is used to facilitate usage of other contracts interacting with Satoru protocol, thus allowing better composability.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/callback/callback_utils.cairo">callback_utils.cairo</a>: It is handling most functions linked to callback.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-module"><a class="header" href="#data-module">Data module</a></h1>
<p>The data module is reponsible for storing and managing the data of the protocol.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/data/data_store.cairo">DataStore</a>: The main smart contract of the module. It is responsible for storing the data of the protocol.</li>
</ul>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/data/keys.cairo">keys.cairo</a>: Contains functions to generate the keys (entries in the data store) of the protocol.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exchange-module"><a class="header" href="#exchange-module">Exchange module</a></h1>
<p>The exchange module contains main satoru handlers to create and execute actions.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/adl_handler.cairo">AdlHandler</a>: Contract to handle adl.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/base_order_handler.cairo">BaseOrderHandler</a>: Base contract for shared order handler functions.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/deposit_handler.cairo">DepositHandler</a>: Contract to handle creation, execution and cancellation of deposits.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/liquidation_handler.cairo">LiquidationHandler</a>: Contract to handle liquidation.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/order_handler.cairo">OrderHandler</a>: Contract to handle creation, execution and cancellation of orders.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/withdrawal_handler.cairo">WithdrawalHandler</a>: Contract to handle creation, execution and cancellation of withdrawals.</li>
</ul>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/error.cairo">error.cairo</a>: Contains the error codes of the module.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/exchange/withdrawal_event_utils.cairo">exchange_utils.cairo</a>: Contains request validation utility function.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="feature-module"><a class="header" href="#feature-module">Feature module</a></h1>
<p>The Feature is used to validate if a feature is enabled or disabled.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/feature/feature_utils.cairo">feature_utils.cairo</a>: It is responsible for validating if a feature is enabled or disabled.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fee-module"><a class="header" href="#fee-module">Fee module</a></h1>
<p>The fee module is for the fees actions.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/fee/fee_handler.cairo">FeeHandler</a>: The main smart contract of the module. It is responsible for claiming the fees from the specified markets.</li>
</ul>
<p>It contains the following Cairo library files:</p>
<ul>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/fee/error.cairo">fee_utils.cairo</a>: Fee actions</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/fee/error.cairo">error.cairo</a>: Contains the error codes of the module.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gas-module"><a class="header" href="#gas-module">Gas Module</a></h1>
<p>The purpose of the gas module is for the execution fee estimation and payments.</p>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/gas/gas_utils.cairo">GasUtils</a>: It is responsible for the execution fee estimation and payments</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="liquidation-module"><a class="header" href="#liquidation-module">Liquidation module</a></h1>
<p>The Liquidation is used to to help with liquidations.</p>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/liquidation/liquidation_utils.cairo">liquidation_utils.cairo</a>: It is responsible for liquidations.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mock"><a class="header" href="#mock">Mock</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nonce-module"><a class="header" href="#nonce-module">Nonce Module</a></h1>
<p>The purpose of the nonce module is to maintain a progressively increasing nonce value. This value plays a crucial role in the generation of keys.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/nonce/nonce_utils.cairo">NonceUtils</a>: The main smart contract of the module. It is used to maintain a progressively increasing nonce value. This value plays a crucial role in the generation of keys.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oracle-module"><a class="header" href="#oracle-module">Oracle Module</a></h1>
<p>The purpose of the oracle module is to validate and store signed values.</p>
<h2 id="price-representation-in-oracle"><a class="header" href="#price-representation-in-oracle">Price representation in Oracle</a></h2>
<p>Representing the prices in this way allows for conversions between token amounts
and fiat values to be simplified, e.g. to calculate the fiat value of a given
number of tokens the calculation would just be: <code>token amount * oracle price</code>,
to calculate the token amount for a fiat value it would be: <code>fiat value oracle price</code>.</p>
<p>The trade-off of this simplicity in calculation is that tokens with a small USD
price and a lot of decimals may have precision issues it is also possible that
a token's price changes significantly and results in requiring higher precision.</p>
<h3 id="example-1"><a class="header" href="#example-1">Example 1</a></h3>
<p>The price of ETH is 5000, and ETH has 18 decimals.</p>
<p>The price of one unit of ETH is <code>5000 (10 ^ 18), 5 * (10 ^ -15)</code>.</p>
<p>To handle the decimals, multiply the value by <code>(10 ^ 30)</code>.</p>
<p>Price would be stored as <code>5000 (10 ^ 18) * (10 ^ 30) =&gt; 5000 * (10 ^ 12)</code>.</p>
<p>For gas optimization, these prices are sent to the oracle in the form of a uint8
decimal multiplier value and uint32 price value.</p>
<p>If the decimal multiplier value is set to 8, the uint32 value would be <code>5000 * (10 ^ 12) (10 ^ 8) =&gt; 5000 * (10 ^ 4)</code>.</p>
<p>With this config, ETH prices can have a maximum value of <code>(2 ^ 32) (10 ^ 4) =&gt; 4,294,967,296 (10 ^ 4) =&gt; 429,496.7296</code> with 4 decimals of precision.</p>
<h3 id="example-2"><a class="header" href="#example-2">Example 2</a></h3>
<p>The price of BTC is 60,000, and BTC has 8 decimals.</p>
<p>The price of one unit of BTC is <code>60,000 (10 ^ 8), 6 * (10 ^ -4)</code>.</p>
<p>Price would be stored as <code>60,000 (10 ^ 8) * (10 ^ 30) =&gt; 6 * (10 ^ 26) =&gt; 60,000 * (10 ^ 22)</code>.</p>
<p>BTC prices maximum value: <code>(2 ^ 32) (10 ^ 2) =&gt; 4,294,967,296 (10 ^ 2) =&gt; 42,949,672.96</code>.</p>
<p>Decimals of precision: 2.</p>
<h3 id="example-3"><a class="header" href="#example-3">Example 3</a></h3>
<p>The price of USDC is 1, and USDC has 6 decimals.</p>
<p>The price of one unit of USDC is <code>1 (10 ^ 6), 1 * (10 ^ -6)</code>.</p>
<p>Price would be stored as <code>1 (10 ^ 6) * (10 ^ 30) =&gt; 1 * (10 ^ 24)</code>.</p>
<p>USDC prices maximum value: <code>(2 ^ 64) (10 ^ 6) =&gt; 4,294,967,296 (10 ^ 6) =&gt; 4294.967296</code>.</p>
<p>Decimals of precision: 6.</p>
<h3 id="example-4"><a class="header" href="#example-4">Example 4</a></h3>
<p>The price of DG is 0.00000001, and DG has 18 decimals.</p>
<p>The price of one unit of DG is <code>0.00000001 (10 ^ 18), 1 * (10 ^ -26)</code>.</p>
<p>Price would be stored as <code>1 * (10 ^ -26) * (10 ^ 30) =&gt; 1 * (10 ^ 3)</code>.</p>
<p>DG prices maximum value: <code>(2 ^ 64) (10 ^ 11) =&gt; 4,294,967,296 (10 ^ 11) =&gt; 0.04294967296</code>.</p>
<p>Decimals of precision: 11.</p>
<h3 id="decimal-multiplier"><a class="header" href="#decimal-multiplier">Decimal Multiplier</a></h3>
<p>The formula to calculate what the decimal multiplier value should be set to:</p>
<p>Decimals: 30 - (token decimals) - (number of decimals desired for precision)</p>
<ul>
<li>ETH: 30 - 18 - 4 =&gt; 8</li>
<li>BTC: 30 - 8 - 2 =&gt; 20</li>
<li>USDC: 30 - 6 - 6 =&gt; 18</li>
<li>DG: 30 - 18 - 11 =&gt; 1.</li>
</ul>
<h3 id="oracle-primary-and-secondary-price"><a class="header" href="#oracle-primary-and-secondary-price">Oracle primary and secondary price</a></h3>
<p>It is possible to update the oracle to support a primary_price and a secondary_price
which would allow for stop-loss orders to be executed at exactly the trigger_price</p>
<p>However, this may lead to gaming issues, an example:</p>
<ul>
<li>The current price is $2020</li>
<li>A user has a long position and creates a stop-loss decrease order for &lt; $2010</li>
<li>If the order has a swap from ETH to USDC and the user is able to cause the order
to be frozen / unexecutable by manipulating state or otherwise</li>
<li>Then if price decreases to $2000, and the user is able to manipulate state such that
the order becomes executable with $2010 being used as the price instead</li>
<li>Then the user would be able to perform the swap at a higher price than should possible</li>
</ul>
<p>Additionally, using the exact order's trigger_price could lead to gaming issues during times
of volatility due to users setting tight stop-losses to minimize loss while betting on a
directional price movement, fees and price impact should help a bit with this, but there
still may be some probability of success</p>
<p>The order keepers can use the closest oracle price to the trigger_price for execution, which
should lead to similar order execution prices with reduced gaming risks</p>
<p>If an order is frozen, the frozen order keepers should use the most recent price for order
execution instead</p>
<hr />
<p>It contains the following files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/oracle/oracle_modules.cairo">oracle_modules.cairo</a>: Modifiers for oracles.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/oracle/oracle_modules.cairo">oracle_store.cairo</a>: Storage for oracles.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/oracle/oracle_utils.cairo">oracle_utils.cairo</a>: Contains utility structs and functions for Oracles.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/oracle/oracle_modules.cairo">oracle.cairo</a>: Main oracle smart contract.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="order-module"><a class="header" href="#order-module">Order module</a></h1>
<p>The order module is reponsible for the vault order, functions related to orders.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/order_vault.cairo">OrderVault</a>: Vault for orders</li>
</ul>
<p>It contains the following Cairo library files:</p>
<ul>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/base_order_utils.cairo">base_order_utils.cairo</a>: This library comprises a collection of frequently used order-related functions, designed to facilitate common operations.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/decrease_order_utils.cairo">decrease_order_utils.cairo</a>: Library for functions to help with processing a decreasing order.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/increase_order_utils.cairo">increase_order_utils.cairo</a>: Library for functions to help with processing a increasing order.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/order.cairo">order.cairo</a>: Struct for orders</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/order.cairo">order_utils.cairo</a>: Library for order functions.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="position-module"><a class="header" href="#position-module">Position Module</a></h1>
<p>The purpose of the position module is to help with management of positions.</p>
<h2 id="fees-in-position"><a class="header" href="#fees-in-position">Fees in position</a></h2>
<p>Borrowing fees for position require only a borrowing_factor to track. An example on how this works is if the global cumulative_borrowing_factor is 10020% a position would be opened with borrowingFactor as 10020%. After some time, if the cumulative__borrowing_factor is updated to 10025% the position would owe 5% of the position size as borrowing fees. The total pending borrowing fees of all positions is factored into the calculation of the pool value for LPs. When a position is increased or decreased, the pending borrowing fees for the position is deducted from the position's
collateral and transferred into the LP pool.</p>
<p>The same borrowing fee factor tracking cannot be applied for funding fees as those calculations consider pending funding fees based on the fiat value of the position sizes.</p>
<p>For example, if the price of the long_token is $2000 and a long position owes $200 in funding fees, the opposing short position claims the funding fees of 0.1 longToken ($200), if the price of the longToken changes to $4000 later, the long position would only owe 0.05 longToken ($200). This would result in differences between the amounts deducted and amounts paid out, for this reason, the actual token amounts to be deducted and to be paid out need to be tracked instead.</p>
<p>For funding fees, there are four values to consider:</p>
<ol>
<li>long positions with market.long_token as collateral.</li>
<li>long positions with market.short_token as collateral.</li>
<li>short positions with market.long_token as collateral.</li>
<li>short positions with market.short_token as collateral.</li>
</ol>
<hr />
<p>It contains the following files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/position/decrease_position_collateral_utils.cairo">decrease_position_collateral_utils.cairo</a>: Library for functions to help with the calculations when decreasing a position.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/position/decrease_position_swap_utils.cairo">decrease_position_swap_utils.cairo</a>: Library for functions related to decrease of position involving swaps.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/position/decrease_position_utils.cairo">decrease_position_utils.cairo</a>: Library for functions to help with decreasing a position.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/position/increase_position_utils.cairo">increase_position_utils.cairo</a>: Library for functions to help with increasing a position.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/position/position_event_utils.cairo">position_event_utils.cairo</a>: Library with helper functions to emit position related events.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/position/position_utils.cairo">position_utils.cairo</a>: Library with various utility functions for positions.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/position/position.cairo">position.cairo</a>: Contains main Position struct.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pricing-module"><a class="header" href="#pricing-module">Pricing module</a></h1>
<p>The pricing module is responsible for functions linked to price computations.</p>
<h2 id="price-impact"><a class="header" href="#price-impact">Price impact</a></h2>
<p>Price impact is calculated as:</p>
<pre><code>(initial imbalance) ^ (price impact exponent) * (price impact factor / 2) - (next imbalance) ^ (price impact exponent) * (price impact factor / 2)
</code></pre>
<p>For spot actions (deposits, withdrawals, swaps), imbalance is calculated as the
difference in the worth of the long tokens and short tokens.</p>
<p>For example:</p>
<ul>
<li>A pool has 10 long tokens, each long token is worth $5000</li>
<li>The pool also has 50,000 short tokens, each short token is worth $1</li>
<li>The <code>price impact exponent</code> is set to 2 and <code>price impact factor</code> is set
to <code>0.01 / 50,000</code></li>
<li>The pool is equally balanced with $50,000 of long tokens and $50,000 of
short tokens</li>
<li>If a user deposits 10 long tokens, the pool would now have $100,000 of long
tokens and $50,000 of short tokens</li>
<li>The change in imbalance would be from $0 to -$50,000</li>
<li>There would be negative price impact charged on the user's deposit,
calculated as <code>0 ^ 2 * (0.01 / 50,000) - 50,000 ^ 2 * (0.01 / 50,000) =&gt; -$500</code></li>
<li>If the user now withdraws 5 long tokens, the balance would change
from -$50,000 to -$25,000, a net change of +$25,000</li>
<li>There would be a positive price impact rebated to the user in the form of
additional long tokens, calculated as <code>50,000 ^ 2 * (0.01 / 50,000) - 25,000 ^ 2 * (0.01 / 50,000) =&gt; $375</code></li>
</ul>
<p>For position actions (increase / decrease position), imbalance is calculated
as the difference in the long and short open interest.</p>
<p><code>price impact exponents</code> and <code>price impact factors</code> are configured per market
and can differ for spot and position actions.</p>
<p>The purpose of the price impact is to help reduce the risk of price manipulation,
since the contracts use an oracle price which would be an average or median price
of multiple reference exchanges. Without a price impact, it may be profitable to
manipulate the prices on reference exchanges while executing orders on the contracts.</p>
<p>This risk will also be present if the positive and negative price impact values
are similar, for that reason the positive price impact should be set to a low
value in times of volatility or irregular price movements.</p>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/pricing/position_pricing_utils.cairo">position_pricing_utils.cairo</a>: Library for position pricing functions.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/pricing/pricing_utils.cairo">pricing_utils.cairo</a>: Library for pricing functions.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/pricing/swap_pricing_utils.cairo">swap_pricing_utils.cairo</a>: Library for pricing functions linked to swaps.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reader-module"><a class="header" href="#reader-module">Reader Module</a></h1>
<p>The purpose of this module is to get financial market data and trading utility library.</p>
<p>It contains the following files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/reader/reader_pricing_utils.cairo">reader_pricing_utils.cairo</a>: Utility functions for trading price, impact, and fee calculations.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/reader/reader_utils.cairo">reader_utils.cairo</a>: External utility functions for trading operations.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/reader/reader.cairo">reader.cairo</a>: Library for reading and calculating financial market data and trading operations.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="referral-module"><a class="header" href="#referral-module">Referral module</a></h1>
<p>The referral module is responsible for managing protocol users affiliations with discount and rebates.</p>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/referral/referral_tier.cairo">referral_tier.cairo</a>: Contains the referral tier struct.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/referral/referral_utils.cairo">referral_utils.cairo</a>: Contains referral utility functions.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="router-module"><a class="header" href="#router-module">Router module</a></h1>
<p>The exchange router is where users utilize the router to initiate token transactions, exchanges, and transfers.</p>
<h2 id="front-running-solution"><a class="header" href="#front-running-solution">Front-running solution</a></h2>
<p>To avoid front-running issues, most actions require two steps to execute:</p>
<ul>
<li>User sends transaction with request details, e.g. deposit / withdraw liquidity,
swap, increase / decrease position.</li>
<li>Keepers listen for the transactions, include the prices for the request then
send a transaction to execute the request.</li>
</ul>
<h2 id="oracle-keepers"><a class="header" href="#oracle-keepers">Oracle keepers</a></h2>
<p>Prices are provided by an off-chain oracle system:</p>
<ul>
<li>Oracle keepers continually check the latest blocks.</li>
<li>When there is a new block, oracle keepers fetch the latest prices from
reference exchanges.</li>
<li>Oracle keepers then sign the median price for each token together with
the block hash.</li>
<li>Oracle keepers then send the data and signature to archive nodes.</li>
<li>Archive nodes display this information for anyone to query.</li>
</ul>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<ul>
<li>Block 100 is finalized on the blockchain.</li>
<li>Oracle keepers observe this block.</li>
<li>Oracle keepers pull the latest prices from reference exchanges,
token A: price 20,000, token B: price 80,000.</li>
<li>Oracle keepers sign [chainId, blockhash(100), 20,000], [chainId, blockhash(100), 80,000].</li>
<li>If in block 100, there was a market order to open a long position for token A,
the market order would have a block number of 100.</li>
<li>The prices signed at block 100 can be used to execute this order.</li>
<li>Order keepers would bundle the signature and price data for token A
then execute the order.</li>
</ul>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/router/router.cairo">Router</a>: Users will approve this router for token expenditures.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/router/exchange_router.cairo">ExchangeRouter</a>: Router for exchange functions, supports functions which require token transfers from the user.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="role-module"><a class="header" href="#role-module">Role module</a></h1>
<p>The role module is responsible for role-based access control.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/role/role_store.cairo">RoleStore</a>: The main smart contract of the module. It is responsible for storing the roles of the protocol and for managing the access control.</li>
</ul>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/role/role.cairo">role.cairo</a>: Contains the different roles of the protocol.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/role/error.cairo">error.cairo</a>: Contains the error codes of the module.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="swap-module"><a class="header" href="#swap-module">Swap module</a></h1>
<p>The swap module is reponsible for swaping.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/swap/swap_handler">SwapHandler</a>: Smart contract to handle swaps.</li>
</ul>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/swap/swap_utils.cairo">swap_utils.cairo</a>: It is responsible for swaping.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="utils-module"><a class="header" href="#utils-module">Utils module</a></h1>
<p>The Utils module is a various collection of utility functions and tools designed to streamline various tasks within the protocol. This module serves as a repository for functions that do not fit into specific categories but are essential for enhancing the efficiency and readability of the codebase.</p>
<p>It contains the following files:</p>
<ul>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/array.cairo">array.cairo</a>: Helps with array manipulation.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">basic_multicall.cairo</a>: Helps with multicall.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">bits.cairo</a>: Bits constants.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">calc.cairo</a>: Various calculations.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">enumerable_values.cairo</a>: Extends EnumerableSet.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">global_reentrancy_guard.cairo</a>: Reentrancy security on a global level.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">hash.cairo</a>: Hash utils.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">precision.cairo</a>: Precisions utils.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">store_contract_address_array.cairo</a>: Implementation of store for Array of ContractAddress.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">u128_mask.cairo</a>: Mask function.</p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/keys.cairo">validate_account.cairo</a>: Helps validating accounts.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="withdrawal-module"><a class="header" href="#withdrawal-module">Withdrawal module</a></h1>
<p>The withdrawal module is responsible for managing withdrawals.</p>
<p>It contains the following smart contracts:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/withdrawal/withdrawal_vault.cairo">WithdrawalVault</a>: Vault for withdrawals.</li>
</ul>
<p>It contains the following Cairo library files:</p>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/withdrawal/error.cairo">error.cairo</a>: Contains the error codes of the module.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/withdrawal/withdrawal_utils.cairo">withdrawal_utils.cairo</a>: Contains withdrawal utility functions.</li>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/withdrawal/withdrawal.cairo">withdrawal.cairo</a>: Contains withdrawal struct.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="continuous-integration"><a class="header" href="#continuous-integration">Continuous Integration</a></h1>
<h2 id="workflows"><a class="header" href="#workflows">Workflows</a></h2>
<p>A workflow is a configurable automated process that will run one or more jobs. Workflows are defined by a YAML file checked in to your repository and will run when triggered by an event in your repository, or they can be triggered manually, or at a defined schedule.</p>
<p>In this section we will run through every workflows and give a detailed explanation of their functionalities.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="github-workflows-documentation"><a class="header" href="#github-workflows-documentation">Github Workflows Documentation</a></h1>
<h2 id="satoru-book-workflow-documentation"><a class="header" href="#satoru-book-workflow-documentation">Satoru Book Workflow Documentation</a></h2>
<h3 id="overview"><a class="header" href="#overview">Overview:</a></h3>
<p>The &quot;Satoru Book&quot; GitHub Actions workflow (<code>book.yml</code>) is specifically designed for the automated build and deployment of the Satoru book's latest version.</p>
<h3 id="workflow-details"><a class="header" href="#workflow-details">Workflow Details:</a></h3>
<p><strong>Workflow Name:</strong> Satoru Book</p>
<p><strong>Trigger Conditions:</strong></p>
<ol>
<li><strong>Push Event:</strong> Activated when changes are pushed to the <code>main</code> branch.</li>
<li><strong>Pull Request Event:</strong> Activated for every pull request.</li>
</ol>
<p><strong>Jobs:</strong></p>
<ol>
<li><strong>Book Build &amp; Deploy Job</strong>:
<ul>
<li><strong>Environment:</strong> Ubuntu 20.04</li>
<li><strong>Concurrency:</strong> Ensures that only one job runs at a time per branch or pull request, preventing potential conflicts.</li>
<li><strong>Steps:</strong>
<ol>
<li><strong>Checkout Repository</strong>: Fetches the repository's content.</li>
<li><strong>Setup mdBook</strong>: Initializes mdBook, a utility for creating online books from markdown files. It uses the latest available version.</li>
<li><strong>Build mdBook</strong>: Constructs the online book using mdBook from the source files located in the <code>./book</code> directory.</li>
<li><strong>Deploy</strong>: If the trigger branch is <code>main</code>, the built book is deployed to GitHub Pages using the specified token. The content to be published is sourced from the <code>./book/book</code> directory.</li>
</ol>
</li>
</ul>
</li>
</ol>
<pre><code class="language-yml">name: Satoru Book

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  book:
    runs-on: ubuntu-20.04
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
    steps:
      - uses: actions/checkout@v2

      - name: Setup mdBook
        uses: peaceiris/actions-mdbook@v1
        with:
          mdbook-version: 'latest'

      - run: mdbook build
        working-directory: ./book

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: ${{ github.ref == 'refs/heads/main' }}
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./book/book
</code></pre>
<h2 id="build-workflow-documentation"><a class="header" href="#build-workflow-documentation">Build Workflow Documentation</a></h2>
<h3 id="overview-1"><a class="header" href="#overview-1">Overview:</a></h3>
<p>The &quot;Build&quot; GitHub Actions workflow (<code>build.yml</code>) is made for building Cairo files using Scarb and checking their format.</p>
<h3 id="workflow-details-1"><a class="header" href="#workflow-details-1">Workflow Details:</a></h3>
<p><strong>Workflow Name:</strong> Build</p>
<p><strong>Trigger Conditions:</strong></p>
<ol>
<li><strong>Push Event:</strong> Activated when changes are pushed to the <code>main</code> branch.</li>
<li><strong>Pull Request Event:</strong> Triggered for every pull request targeting the <code>main</code> branch.</li>
</ol>
<p><strong>Environment Variables:</strong></p>
<ul>
<li><strong>SCARB_VERSION:</strong> Specifies the version of Scarb to be used, currently set to <code>0.7.0</code>.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Currently, we are utilizing the nightly versions of Scarb to leverage the latest features of Cairo. The installation process is slightly different than using non-nightly versions. Once Cairo and Scarb stabilize, we will migrate to stable versions and employ the <code>software-mansion/setup-scarb</code> action for easier setup.</p>
</blockquote>
<p><strong>Jobs:</strong></p>
<ol>
<li><strong>Cairo Check &amp; Build Job</strong>:
<ul>
<li><strong>Environment:</strong> Latest version of Ubuntu.</li>
<li><strong>Steps:</strong>
<ol>
<li><strong>Checkout Repository</strong>: Fetches the repository's content.</li>
<li><strong>Set up Scarb</strong>: Instead of using the conventional setup action, we fetch the nightly version of Scarb directly from its release page and place the binary in the required path.</li>
<li><strong>Check Cairo Format</strong>: Ensures the Cairo files follow the expected format.</li>
<li><strong>Build Cairo Programs</strong>: Compiles the Cairo files.</li>
</ol>
</li>
</ul>
</li>
</ol>
<pre><code class="language-yml">name: Build

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main
env:
  SCARB_VERSION: 0.7.0

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: software-mansion/setup-scarb@v1
        with:
          scarb-version: &quot;0.7.0&quot;
      - name: Check cairo format
        run: scarb fmt --check
      - name: Build cairo programs
        run: scarb build
</code></pre>
<h2 id="security-workflow-documentation"><a class="header" href="#security-workflow-documentation">Security Workflow Documentation</a></h2>
<h3 id="overview-2"><a class="header" href="#overview-2">Overview:</a></h3>
<p>The &quot;Security&quot; GitHub Actions workflow (<code>security.yml</code>) is designed to enforce security standards and conduct safety checks on the codebase. It ensures that code modifications follow best security practices and identifies potential vulnerabilities.</p>
<h3 id="workflow-details-2"><a class="header" href="#workflow-details-2">Workflow Details:</a></h3>
<p><strong>Workflow Name:</strong> Security</p>
<p><strong>Trigger Conditions:</strong></p>
<ol>
<li><strong>Push Event:</strong> Activated when changes are pushed to the <code>main</code> branch.</li>
<li><strong>Pull Request Event:</strong> Triggered for every pull request targeting the <code>main</code> branch.</li>
</ol>
<p><strong>Jobs:</strong></p>
<ol>
<li><strong>Security Check Job</strong>:
<ul>
<li><strong>Environment:</strong> Latest version of Ubuntu.</li>
<li><strong>Steps:</strong>
<ol>
<li><strong>Checkout Repository</strong>: Retrieves the repository's content.</li>
<li><strong>Install Semgrep</strong>: Installs Semgrep, a static code analysis tool, to identify potential security issues.</li>
<li><strong>Run Semgrep</strong>: Executes Semgrep with a custom configuration sourced from a release of <code>semgrep-cairo-rules</code>. Results are written to <code>semgrep-output.txt</code>.</li>
<li><strong>Save Semgrep Output</strong>: Archives the Semgrep results as an artifact named <code>semgrep-cairo</code>.</li>
</ol>
</li>
</ul>
</li>
</ol>
<pre><code class="language-yml">name: Security

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Semgrep
        run: |
          pip install semgrep
      - name: Run Semgrep
        run: semgrep --config https://github.com/avnu-labs/semgrep-cairo-rules/releases/download/v0.0.1/cairo-rules.yaml ./src &gt; semgrep-output.txt
      - name: Save Semgrep Output as an Artifact
        uses: actions/upload-artifact@v3
        with:
          name: semgrep-cairo
          path: semgrep-output.txt
</code></pre>
<h2 id="test-workflow-documentation"><a class="header" href="#test-workflow-documentation">Test Workflow Documentation</a></h2>
<h3 id="overview-3"><a class="header" href="#overview-3">Overview:</a></h3>
<p>The &quot;Test&quot; GitHub Actions workflow (<code>test.yml</code>) ensures the code's integrity by validating its functionality. It aims to detect any potential issues introduced by new code modifications, guaranteeing that they do not impact the existing codebase.</p>
<h3 id="workflow-details-3"><a class="header" href="#workflow-details-3">Workflow Details:</a></h3>
<p><strong>Workflow Name:</strong> Test</p>
<p><strong>Trigger Conditions:</strong></p>
<ol>
<li><strong>Push Event:</strong> Activated when changes are pushed to the <code>main</code> branch.</li>
<li><strong>Pull Request Event:</strong> Triggered for pull requests targeting the <code>main</code> branch.</li>
</ol>
<p><strong>Environment Variables:</strong></p>
<ul>
<li><strong>SCARB_VERSION:</strong> Specifies the Scarb version, currently set to <code>0.7.0</code>.</li>
<li><strong>STARKNET_FOUNDRY_VERSION:</strong> Defines the version of Starknet Foundry, currently set to <code>0.7.0</code>.</li>
</ul>
<p><strong>Jobs:</strong></p>
<ol>
<li><strong>Test &amp; Check Job</strong>:
<ul>
<li><strong>Environment:</strong> Latest version of Ubuntu.</li>
<li><strong>Steps:</strong>
<ol>
<li><strong>Checkout Repository</strong>: Retrieves the contents of the repository.</li>
<li><strong>Set up Scarb</strong>: Fetches the nightly version of Scarb directly from its release page and places the binary in the required path.</li>
<li><strong>Install Starknet Foundry</strong>: Installs the specified version of Starknet Foundry using a curl command.</li>
<li><strong>Run Cairo Tests</strong>: Executes tests using the <code>snforge</code> command.</li>
</ol>
</li>
</ul>
</li>
</ol>
<pre><code class="language-yml">name: Test

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main
env:
  SCARB_VERSION: 0.7.0
  STARKNET_FOUNDRY_VERSION: 0.7.0

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: software-mansion/setup-scarb@v1
        with:
          scarb-version: &quot;0.7.0&quot;
      - name: Install starknet foundry
        run: curl -L https://raw.githubusercontent.com/foundry-rs/starknet-foundry/master/scripts/install.sh | sh -s -- -v ${STARKNET_FOUNDRY_VERSION}
      - name: Run cairo tests
        run: snforge
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
